<svg viewBox="0 0 1200 800" xmlns="http://www.w3.org/2000/svg">
  <!-- Background -->
  <rect width="1200" height="800" fill="#f8f9fa"/>
  
  <!-- Title -->
  <text x="600" y="30" text-anchor="middle" font-size="20" font-weight="bold" fill="#2c3e50">
    Company Classification Processing Flow (Batch Size = 10)
  </text>
  
  <!-- Input CSV -->
  <rect x="50" y="70" width="120" height="60" rx="5" fill="#3498db" stroke="#2980b9" stroke-width="2"/>
  <text x="110" y="95" text-anchor="middle" font-size="12" fill="white" font-weight="bold">CSV Input</text>
  <text x="110" y="110" text-anchor="middle" font-size="10" fill="white">100 Companies</text>
  
  <!-- Arrow 1 -->
  <path d="M 170 100 L 210 100" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Batch Creation -->
  <rect x="220" y="70" width="120" height="60" rx="5" fill="#e74c3c" stroke="#c0392b" stroke-width="2"/>
  <text x="280" y="90" text-anchor="middle" font-size="12" fill="white" font-weight="bold">Batch Creation</text>
  <text x="280" y="105" text-anchor="middle" font-size="10" fill="white">10 batches of</text>
  <text x="280" y="118" text-anchor="middle" font-size="10" fill="white">10 companies each</text>
  
  <!-- Arrow 2 -->
  <path d="M 340 100 L 380 100" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Single Batch Processing -->
  <rect x="390" y="60" width="140" height="80" rx="5" fill="#9b59b6" stroke="#8e44ad" stroke-width="2"/>
  <text x="460" y="80" text-anchor="middle" font-size="12" fill="white" font-weight="bold">Single Batch</text>
  <text x="460" y="95" text-anchor="middle" font-size="11" fill="white">Company 1: Microsoft</text>
  <text x="460" y="108" text-anchor="middle" font-size="11" fill="white">Company 2: Amazon</text>
  <text x="460" y="121" text-anchor="middle" font-size="11" fill="white">... (10 companies)</text>
  
  <!-- Arrow 3 -->
  <path d="M 530 100 L 570 100" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- LangChain Agent -->
  <rect x="580" y="70" width="140" height="60" rx="5" fill="#f39c12" stroke="#e67e22" stroke-width="2"/>
  <text x="650" y="90" text-anchor="middle" font-size="12" fill="white" font-weight="bold">LangChain Agent</text>
  <text x="650" y="105" text-anchor="middle" font-size="10" fill="white">Receives batch prompt</text>
  <text x="650" y="118" text-anchor="middle" font-size="10" fill="white">with 10 companies</text>
  
  <!-- Arrow down to tools -->
  <path d="M 650 130 L 650 170" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Tools Section -->
  <rect x="400" y="180" width="500" height="200" rx="5" fill="#ecf0f1" stroke="#bdc3c7" stroke-width="2"/>
  <text x="650" y="200" text-anchor="middle" font-size="14" font-weight="bold" fill="#2c3e50">Tool Execution Phase</text>
  
  <!-- Step 1: Taxonomy -->
  <rect x="420" y="220" width="120" height="50" rx="3" fill="#1abc9c" stroke="#16a085" stroke-width="1"/>
  <text x="480" y="235" text-anchor="middle" font-size="10" fill="white" font-weight="bold">Step 1</text>
  <text x="480" y="248" text-anchor="middle" font-size="9" fill="white">search_show_categories</text>
  <text x="480" y="260" text-anchor="middle" font-size="8" fill="white">(1 call - get taxonomy)</text>
  
  <!-- Step 2: Individual Perplexity calls -->
  <rect x="560" y="220" width="120" height="50" rx="3" fill="#3498db" stroke="#2980b9" stroke-width="1"/>
  <text x="620" y="235" text-anchor="middle" font-size="10" fill="white" font-weight="bold">Step 2</text>
  <text x="620" y="248" text-anchor="middle" font-size="9" fill="white">perplexity_advanced_search</text>
  <text x="620" y="260" text-anchor="middle" font-size="8" fill="white">(10 calls - 1 per company)</text>
  
  <!-- Step 3: Additional taxonomy checks -->
  <rect x="700" y="220" width="120" height="50" rx="3" fill="#1abc9c" stroke="#16a085" stroke-width="1"/>
  <text x="760" y="235" text-anchor="middle" font-size="10" fill="white" font-weight="bold">Step 3</text>
  <text x="760" y="248" text-anchor="middle" font-size="9" fill="white">search_show_categories</text>
  <text x="760" y="260" text-anchor="middle" font-size="8" fill="white">(~5-10 calls - matching)</text>
  
  <!-- Individual API calls breakdown -->
  <text x="650" y="290" text-anchor="middle" font-size="12" font-weight="bold" fill="#2c3e50">Individual API Calls Per Company:</text>
  
  <!-- Company examples -->
  <rect x="420" y="300" width="100" height="35" rx="3" fill="#e8f5e8" stroke="#27ae60" stroke-width="1"/>
  <text x="470" y="315" text-anchor="middle" font-size="9" fill="#27ae60">Company 1:</text>
  <text x="470" y="328" text-anchor="middle" font-size="8" fill="#27ae60">"Microsoft cloud services"</text>
  
  <rect x="530" y="300" width="100" height="35" rx="3" fill="#e8f5e8" stroke="#27ae60" stroke-width="1"/>
  <text x="580" y="315" text-anchor="middle" font-size="9" fill="#27ae60">Company 2:</text>
  <text x="580" y="328" text-anchor="middle" font-size="8" fill="#27ae60">"Amazon web services"</text>
  
  <rect x="640" y="300" width="100" height="35" rx="3" fill="#e8f5e8" stroke="#27ae60" stroke-width="1"/>
  <text x="690" y="315" text-anchor="middle" font-size="9" fill="#27ae60">Company 3:</text>
  <text x="690" y="328" text-anchor="middle" font-size="8" fill="#27ae60">"Google search tech"</text>
  
  <text x="770" y="318" text-anchor="middle" font-size="12" fill="#27ae60">... (10 total)</text>
  
  <!-- Arrow down from tools -->
  <path d="M 650 380 L 650 420" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- LLM Processing -->
  <rect x="580" y="430" width="140" height="60" rx="5" fill="#8e44ad" stroke="#7d3c98" stroke-width="2"/>
  <text x="650" y="450" text-anchor="middle" font-size="12" fill="white" font-weight="bold">Azure OpenAI LLM</text>
  <text x="650" y="465" text-anchor="middle" font-size="10" fill="white">Processes all results</text>
  <text x="650" y="478" text-anchor="middle" font-size="10" fill="white">+ generates table</text>
  
  <!-- Arrow down to output -->
  <path d="M 650 490 L 650 530" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Output Table -->
  <rect x="580" y="540" width="140" height="60" rx="5" fill="#27ae60" stroke="#229954" stroke-width="2"/>
  <text x="650" y="560" text-anchor="middle" font-size="12" fill="white" font-weight="bold">Markdown Table</text>
  <text x="650" y="575" text-anchor="middle" font-size="10" fill="white">10 companies with</text>
  <text x="650" y="588" text-anchor="middle" font-size="10" fill="white">taxonomy categories</text>
  
  <!-- Cost Analysis Box -->
  <rect x="50" y="400" width="200" height="150" rx="5" fill="#fff5f5" stroke="#e74c3c" stroke-width="2"/>
  <text x="150" y="420" text-anchor="middle" font-size="12" font-weight="bold" fill="#e74c3c">API Costs Per Batch</text>
  <text x="60" y="440" font-size="10" fill="#2c3e50">• 1 taxonomy call (free)</text>
  <text x="60" y="455" font-size="10" fill="#2c3e50">• 10 Perplexity calls ($)</text>
  <text x="60" y="470" font-size="10" fill="#2c3e50">• ~5-10 taxonomy calls (free)</text>
  <text x="60" y="485" font-size="10" fill="#2c3e50">• 1 Azure OpenAI call ($)</text>
  <text x="60" y="510" font-size="11" font-weight="bold" fill="#e74c3c">Total: ~11-12 paid API calls</text>
  <text x="60" y="525" font-size="9" fill="#7f8c8d">per 10 companies</text>
  
  <!-- Performance Notes -->
  <rect x="950" y="400" width="200" height="150" rx="5" fill="#f0f8ff" stroke="#3498db" stroke-width="2"/>
  <text x="1050" y="420" text-anchor="middle" font-size="12" font-weight="bold" fill="#3498db">Performance Notes</text>
  <text x="960" y="440" font-size="10" fill="#2c3e50">• Agent parallelizes calls</text>
  <text x="960" y="455" font-size="10" fill="#2c3e50">• Each company gets focused</text>
  <text x="960" y="470" font-size="10" fill="#2c3e50">  research (higher accuracy)</text>
  <text x="960" y="485" font-size="10" fill="#2c3e50">• Taxonomy calls are cached</text>
  <text x="960" y="500" font-size="10" fill="#2c3e50">• Single LLM call per batch</text>
  <text x="960" y="525" font-size="11" font-weight="bold" fill="#3498db">Optimized for quality</text>
  <text x="960" y="540" font-size="9" fill="#7f8c8d">over cost</text>
  
  <!-- Process Flow Legend -->
  <rect x="50" y="600" width="300" height="120" rx="5" fill="#fdfefe" stroke="#85929e" stroke-width="1"/>
  <text x="200" y="620" text-anchor="middle" font-size="12" font-weight="bold" fill="#2c3e50">Process Timing</text>
  <text x="60" y="640" font-size="10" fill="#2c3e50">1. CSV → Batches: Instant</text>
  <text x="60" y="655" font-size="10" fill="#2c3e50">2. Agent Setup: ~2-3 seconds</text>
  <text x="60" y="670" font-size="10" fill="#2c3e50">3. Tool Calls: ~30-60 seconds</text>
  <text x="60" y="685" font-size="10" fill="#2c3e50">4. LLM Processing: ~10-20 seconds</text>
  <text x="60" y="700" font-size="11" font-weight="bold" fill="#27ae60">Total per batch: ~1-2 minutes</text>
  
  <!-- Why Individual Calls Box -->
  <rect x="400" y="600" width="350" height="120" rx="5" fill="#fff9e6" stroke="#f39c12" stroke-width="1"/>
  <text x="575" y="620" text-anchor="middle" font-size="12" font-weight="bold" fill="#f39c12">Why Individual Calls?</text>
  <text x="410" y="640" font-size="10" fill="#2c3e50">✓ Better research quality per company</text>
  <text x="410" y="655" font-size="10" fill="#2c3e50">✓ Focused queries get better Perplexity results</text>
  <text x="410" y="670" font-size="10" fill="#2c3e50">✓ Agent can adapt research per company type</text>
  <text x="410" y="685" font-size="10" fill="#2c3e50">✓ More accurate taxonomy matching</text>
  <text x="410" y="700" font-size="10" fill="#2c3e50">✗ Higher API costs (trade-off for quality)</text>
  
  <!-- Batch Repetition -->
  <rect x="800" y="600" width="150" height="80" rx="5" fill="#f4f1fb" stroke="#9b59b6" stroke-width="1"/>
  <text x="875" y="620" text-anchor="middle" font-size="11" font-weight="bold" fill="#9b59b6">Batch Repetition</text>
  <text x="810" y="640" font-size="9" fill="#2c3e50">This entire process</text>
  <text x="810" y="653" font-size="9" fill="#2c3e50">repeats for each</text>
  <text x="810" y="666" font-size="9" fill="#2c3e50">batch (10 times for</text>
  <text x="810" y="679" font-size="9" fill="#2c3e50">100 companies)</text>
  
  <!-- Arrow marker definition -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#2c3e50"/>
    </marker>
  </defs>
  
  <!-- Final Output Arrow -->
  <path d="M 720 570 L 800 570 L 800 550 L 950 550" stroke="#27ae60" stroke-width="3" marker-end="url(#arrowhead)" stroke-dasharray="5,5"/>
  <text x="875" y="545" text-anchor="middle" font-size="10" font-weight="bold" fill="#27ae60">Final Results</text>
  
  <!-- Results Box -->
  <rect x="960" y="520" width="180" height="80" rx="5" fill="#e8f5e8" stroke="#27ae60" stroke-width="2"/>
  <text x="1050" y="540" text-anchor="middle" font-size="11" font-weight="bold" fill="#27ae60">output_100_p.md</text>
  <text x="1050" y="555" text-anchor="middle" font-size="11" font-weight="bold" fill="#27ae60">output_100_p.csv</text>
  <text x="1050" y="570" text-anchor="middle" font-size="9" fill="#27ae60">100 companies with</text>
  <text x="1050" y="583" text-anchor="middle" font-size="9" fill="#27ae60">taxonomy classifications</text>
</svg>